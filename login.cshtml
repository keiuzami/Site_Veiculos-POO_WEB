@using WebMatrix.Data
@{
    Page.Title = "Login";
    var db = Database.Open("dbSiteVeiculos");
    if (IsPost)
    {
        var email = Request.Form["email"];
        var senha = Request.Form["senha"];
        var usuario = db.QuerySingle("select * from usuario where email=@0", email);
        if(usuario!=null)
        {
            if (usuario.senha == senha)
            {
                Session["usuario"] = new UsuarioViewModel()
                {
                    Email = usuario.email,
                    Nome = usuario.nome
                };                
                Response.Redirect("index.cshtml");
            }
        }
    }
    //Validation.RequireFields("Nome", "Modelo", "Ano", "Imagem", "Fabricante_Id", "PrecoMedio");
    //Validation.Add("Nome", Validator.StringLength(80, 2));
    //Validation.Add("Modelo", Validator.StringLength(80, 2));
    //Validation.Add("Imagem", Validator.StringLength(80, 2));
    //Validation.Add("Ano", Validator.Integer());
    //Validation.Add("Fabricante_Id", Validator.Integer());
    //Validation.Add("PrecoMedio", Validator.Decimal());

    //int result = 1;

    /*
    * No GET é iniciado com valores default pq Request.Form estára vazio
    * No POST é iniciado com os valores informados pelo usuário e, caso a
    * validação falhe os dados são retornados para os campos do formulário
    * assim o usuário poderá realizar as devidas correções
    */
    //var veiculo = new VeiculoViewModel(Request.Form);

    //

    //var listaFabricantes = db.Query("select * from Fabricante");

    //if (IsPost && Validation.IsValid())
    //{
    //    result = db.Execute(@"update Veiculo set 
    //        Nome = @0, Modelo = @1, Imagem = @2, Ano = @3, Fabricante_Id = @4, PrecoMedio = @5
    //        where Id = @6", 
    //        veiculo.Nome, veiculo.Modelo, veiculo.Imagem, veiculo.Ano,
    //        veiculo.Fabricante_Id, veiculo.PrecoMedio, veiculo.Id);

    //    if (result == 1)
    //    {
    //        Response.Redirect("~/Veiculos/Index.cshtml");
    //    }

    //}
    //else if (!IsPost)
    //{
    //    if (Request.QueryString["veiculo_id"].IsEmpty())
    //    {
    //        Response.Redirect("~/Veiculos/Index.cshtml");
    //    }

    //    var _veiculo = db.QuerySingle("select * from Veiculo where id = @0", Request.QueryString["veiculo_id"]);
    //    veiculo = new VeiculoViewModel(_veiculo);
    //}

    //db.Close();
}
<html>
<head>
    <title>@Page.Title</title>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/bootstrap-theme.min.css" rel="stylesheet" />    
    <style>
        .field-validation-error {
            color: #b94a48;
        }

        .field-validation-valid {
            display: none;
        }

        input.input-validation-error {
            border: 1px solid #b94a48;
        }


        select.input-validation-error {
            border: 1px solid #b94a48;
        }

        input[type="checkbox"].input-validation-error {
            border: 0 none;
        }

        .validation-summary-errors {
            color: #b94a48;
        }

        .validation-summary-valid {
            display: none;
        }
    </style>
</head>
<body> 
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />

    <form action="~/login.cshtml" class="col-lg-4 col-lg-offset-4" method="post">
        <div class="form-group">
            <label>Email</label>
            <input name="email" class="form-control" type="text" />
        </div>
        <div class="form-group">
            <label>Senha</label>
            <input type="password" name="senha" class="form-control" />
        </div>
        <div class="form-group">
            <button type="submit" class="btn btn-success">COME IN MOTHERFUCKER</button>
        </div>
    </form>
</body>
</html>